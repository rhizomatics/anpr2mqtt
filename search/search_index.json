{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"ANPR2MQTT","text":""},{"location":"#anpr2mqtt","title":"anpr2mqtt","text":""},{"location":"#anpr-mqtt-bridge","title":"ANPR MQTT Bridge","text":"<p>A simple way to integrate CCTV cameras with built-in ANPR (Automatic Number Plate Recognition, aka ALPR or Automatic Licence Plate Recognition) to MQTT for Home Assistant integration, or any other MQTT consumer. Running under Docker is preferred but not necessary.</p> <p>All that is needed is for the camera to be configured to upload images on plate recognition, by ftp, NAS or whatever else. ANPR2MQTT monitors the directory where the images lands and publishes plate information to MQTT. Its simple, requires no proprietary vendor APIs ( or differing ONVIF implementations ), and Home Assistant gets a copy of the actual annotated detection image to use on dashboards or to attach to notifications.</p> <p>While intended for vehicle plate detection, it can be used to watch for and analyze any file, so for example uploaded face detection or line crossing images. A single <code>anpr2mqtt</code> instance can watch multiple paths and patterns for different cameras and events.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Minimal configuration<ul> <li>Ready configured to work with popular Hikvision ANPR camera settings</li> <li>See Example Camera Configuration</li> </ul> </li> <li>File System Integration<ul> <li>Watches directory for ANPR camera images using Watchdog<ul> <li>Uses inotify on Linux, or equiv on other operating systems for efficient listening to file system events without continual polling</li> </ul> </li> <li>Extracts target ( for example licence plate ), timestamp and event type information from filenames</li> </ul> </li> <li>Home Assistant Integration. <ul> <li>Publishes events to MQTT for Home Assistant as a MQTT Sensor Entity</li> <li>Auto-discovery configuration for Home Assistant</li> <li>Creates MQTT Image Entity on Home Assistant for image snapshot, so no web access to ftp needed</li> </ul> </li> <li>Plate Enrichment<ul> <li>OCR-based extraction of fields using tesseract-ocr<ul> <li>By default direction detection (Forward/Reverse) </li> <li>Corrections by regular expression to fix OCR mis-readings</li> </ul> </li> <li>Tracks and counts previous sightings</li> <li>Configurable to classify plates as known, to be ignored or as a potential threat</li> <li>Regular expression based corrections, for known plates that the ANPR sometimes mis-reads</li> <li>UK Only<ul> <li>DVLA Lookup if API_KEY provided, for detailed MOT and tax information</li> <li>Lookups cached for configurable time</li> </ul> </li> </ul> </li> <li>Debug Tools built-in</li> </ul>"},{"location":"#docker-deployment","title":"Docker Deployment","text":"<p>Build and run with Docker, example docker-compose.yaml provided.</p>"},{"location":"#configuration","title":"Configuration","text":"<p>ANPR2MQTT uses pydantic-settings, which means configuration can happen in a variety of ways, and these can be combined - yaml configuration file, environment variables, Docker Secrets, built-in defaults, and <code>.env</code> file or command line arguments.</p>"},{"location":"#home-assistant-integration","title":"Home Assistant Integration","text":"<p>See Home Assistant Integration for configuration and example notification automation.</p>"},{"location":"#environment-variables","title":"Environment Variables","text":"<p>pydantic-settings needs double underscores for environment variables in config sections. For example, <code>MQTT__HOST</code> means set the value <code>host</code> in the <code>mqtt</code> config section.</p> Env Variable Description Default <code>MQTT__HOST</code> MQTT broker hostname <code>localhost</code> <code>MQTT__PORT</code> MQTT broker port <code>1883</code> <code>MQTT__TOPIC_ROOT</code> MQTT topic for events <code>anpr2mqtt</code> <code>MQTT__USER</code> MQTT username - <code>MQTT__PASS</code> MQTT password - <code>LOG_LEVEL</code> Python logging level INFO <code>DVLA__API_KEY</code> API Key for Gov API Lookup -"},{"location":"#image-filename-format","title":"Image Filename Format","text":"<p>Expected format: <code>YYYYMMDDHHMMSSmmm_PLATE_VEHICLE_DETECTION.jpg</code></p> <p>Example: <code>20180502174029596_A2GEO_VEHICLE_DETECTION.jpg</code></p> <p>A regular expression can be defined to match different file name formats.</p>"},{"location":"#image-box-coordinates","title":"Image Box Coordinates","text":"<p>Where cameras provide an estimated direction for the vehicle, this can be captured via OCR and included in the response. See OCR for an explanation and examples.</p>"},{"location":"#primary-dependencies","title":"Primary Dependencies","text":"<ul> <li>watchdog - File system monitoring (cross-platform)</li> <li>paho-mqtt - MQTT client</li> <li>Pillow - Image processing</li> <li>pytesseract - OCR for direction detection</li> <li>structlog - Structured logging</li> <li>httpx - API Client</li> <li>hishel - API result caching</li> </ul>"},{"location":"#distribution","title":"Distribution","text":"<p>ANPR2MQTT is free and open sourced under the Apache 2.0 license.</p>"},{"location":"api/","title":"API","text":"","tags":["DVLA","API","VES"]},{"location":"api/#dvla","title":"DVLA","text":"<p>The United Kingdom's government free Vehicle Enquiry Service (VES) API for licence lookup is supported directly.</p> <p>Instructions for obtaining the required API Key and current URL are at the DVLA Developer Portal, with the best place to start Register For VES API. They also have a Postman Collection for debugging and testing.</p> <p>Configure the API key using the <code>DVLA__API_KEY</code> environment variable, the CLI argument, or in the configuration</p> <pre><code>dvla:\n    api_key: 59859j545h458957\n    cache_ttl: 86400 # number of seconds to cache the result\n</code></pre>","tags":["DVLA","API","VES"]},{"location":"api/#example-response","title":"Example Response","text":"<pre><code>{\n  \"artEndDate\": \"2025-02-28\",\n  \"co2Emissions\" : 135,\n  \"colour\" : \"BLUE\",\n  \"engineCapacity\": 2494,\n  \"fuelType\" : \"PETROL\",\n  \"make\" : \"ROVER\",\n  \"markedForExport\" : false,\n  \"monthOfFirstRegistration\" : \"2004-12\",\n  \"motStatus\" : \"No details held by DVLA\",\n  \"registrationNumber\" : \"ABC1234\",\n  \"revenueWeight\" : 1640,\n  \"taxDueDate\" : \"2007-01-01\",\n  \"taxStatus\" : \"Untaxed\",\n  \"typeApproval\" : \"N1\",\n  \"wheelplan\" : \"NON STANDARD\",\n  \"yearOfManufacture\" : 2004,\n  \"euroStatus\": \"EURO 6 AD\",\n  \"realDrivingEmissions\": \"1\",\n  \"dateOfLastV5CIssued\": \"2016-12-25\"\n}\n</code></pre>","tags":["DVLA","API","VES"]},{"location":"camera/","title":"ANPR Camera Configuration","text":"","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#hikvision","title":"Hikvision","text":"","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#example","title":"Example","text":"<p>This example uses the DS-2CD4A25FWD-IZS, one of the very first ANPR enabled Hikvision cameras, on its own, without any NVR.</p> <p>ANPR configuration, including posting images via ftp, is configured in the Road Traffic menu under Advanced.</p> <p></p> <p>At the bottom of the page is the configuration for actions upon detecting a plate.</p> <p></p> <p>The server name, user name and password, and upload directory for this ftp are set once for all ftp actions in the Network menu under Advanced Configuration.</p> <p></p> <p>Some of the results of the recognition algorithm are available either on the picture and/or as part of the image file name. Direction is one that's only available with this model on the image. Its also possible to play with text colour here, although <code>anpr2mqtt</code> will optionally invert the colours pre-scan, so its possible to leave it as white text on black background to be clearer for humans to read.</p> <p></p> <p>The file name format is configurable, it should have the licence plate included and the timestamp to work with the default <code>anpr2mqtt</code> regular expression. There's no need to include camera number if there's only one ANPR camera.</p> <p></p>","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#image-settings","title":"Image Settings","text":"<p>The Hikvision camera has a special set of image settings bundled as a Mounting Scenario</p> <p></p> <p>One side-effect of this is that the camera can be practically useless as a general purpose CCTV camera in anything other than very bright conditions if the Road Mounting Scenario is chosen.</p> <p>One way of coping with this is to switch between mount scenarios, so its Normal at day time and Road at night, or have it on Road only when there is heightened security need.</p>","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#home-assistant-automated-mount-scenario-change","title":"Home Assistant Automated Mount Scenario Change","text":"<p>Set up two REST commands, changing <code>192.168.1.100</code> for the IP address or host name of your own camera, and adding <code>hik_user</code> and <code>hik_password</code> values to the <code>secrets.yaml</code> file (see Storing Secrets).</p> REST Command Definitions<pre><code>driveway_cam_road:\n    url: http://192.168.1.100/ISAPI/Image/channels/1/mountingScenario\n    method: put\n    content_type: text/xml\n    username: !secret hik_user\n    password: !secret hik_password\n    payload: '&lt;MountingScenario xmlns=\"http://www.hikvision.com/ver20/XMLSchema\" version=\"2.0\"&gt;&lt;mode&gt;road&lt;/mode&gt;&lt;/MountingScenario&gt;'\n\ndriveway_cam_normal:\n    url: http://192.168.1.100/ISAPI/Image/channels/1/mountingScenario\n    method: put\n    content_type: text/xml\n    username: !secret hik_user\n    password: !secret hik_password\n    payload: '&lt;MountingScenario xmlns=\"http://www.hikvision.com/ver20/XMLSchema\" version=\"2.0\"&gt;&lt;mode&gt;normal&lt;/mode&gt;&lt;/MountingScenario&gt;'\n</code></pre> <p>These commands can now be used in Home Assistant automations as actions, triggered by time of day, state of sun etc.</p> <p></p>","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#other-cameras","title":"Other Cameras","text":"<ul> <li>See Which Hikvision ANPR Camera Should I Buy in 2025? FAQ from use-IP Forum</li> </ul>","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"camera/#other-ways-to-integrate","title":"Other Ways to Integrate","text":"<ul> <li>Home Assistant built-in Hikvision Integration <ul> <li>Has support for 'Surveillance Center' notifications but with open issue #115631 for ANPR integration.</li> </ul> </li> </ul>","tags":["cctv","hikvision","anpr","DS-2CD4A25FWD-IZS","ftp","alpr","lpr"]},{"location":"changelog/","title":"0.7.0","text":""},{"location":"changelog/#home-assistant-integration","title":"Home Assistant Integration","text":"<ul> <li>Now subscribes to the HA 'birth' and 'last will' messages to re-publish on HA restart</li> <li>State always published at startup</li> </ul>"},{"location":"changelog/#directory-scanning","title":"Directory Scanning","text":"<ul> <li><code>watch_tree</code> can be set to recursively watch all subdirectories below <code>watch_path</code></li> </ul>"},{"location":"changelog/#mqtt","title":"MQTT","text":"<ul> <li>MQTT protocol can now be set up to v5 or down to v3, defaults to v3.11</li> </ul>"},{"location":"changelog/#062","title":"0.6.2","text":""},{"location":"changelog/#examples","title":"Examples","text":"<ul> <li>Added an example Home Assistant automation to generate notifications using details and priority from MQTT event</li> </ul>"},{"location":"changelog/#061","title":"0.6.1","text":"<ul> <li>Log state topic at startup</li> </ul>"},{"location":"changelog/#060","title":"0.6.0","text":"<ul> <li>Multiple events now supported, e.g. face detection or line crossing</li> <li>OCR field definitions can be reused across events, or different crop definitions for the same value</li> <li>For example, <code>vehicle_direction</code> could have different bounding boxes, or even values, on different cameras</li> <li>Suggested area provided for Home Assistant Device if configured</li> </ul>"},{"location":"changelog/#050","title":"0.5.0","text":"<ul> <li>Home Assistant Device creation optional</li> <li>Simplified OCR coordinates</li> <li>Flexible OCR field capture</li> </ul>"},{"location":"changelog/#041","title":"0.4.1","text":"<ul> <li>Improve CLI handling for tools</li> <li>File name parsing now more forgiving of regexp format</li> </ul>"},{"location":"changelog/#040","title":"0.4.0","text":"<ul> <li>CLI handling and env vars switched from click to pydantic-settings</li> <li>Added new anpr2mqtt.yaml config</li> <li>Migrated sightings tracker from appdaemon app</li> <li>Migrated plate classification from appdaemon app</li> <li>Added DVLA api lookup from appdaemon app</li> </ul>"},{"location":"debug_tools/","title":"Debug Tools","text":"<p>ANPR2MQTT has additional command line options to help debug file system integration or OCR.</p>"},{"location":"debug_tools/#ocr","title":"OCR","text":"<p>This will load the image, run the OCR on the (optionally cropped and inverted image) and report the value. It will ignore any yaml config, though will respect environment variables. This can be useful for quick feedback cycle with a local image and bounding boxes.</p> <pre><code> uv run tools ocr_file 20241230152519495_N74DYX_VEHICLE_DETECTION.jpg\n</code></pre> <p>The default configuration can be overridden from the command line, and a specific OCR field configured</p> <pre><code>uv run tools ocr_file fixtures/20250602103045407_B4DM3N_VEHICLE_DETECTION.jpg --ocr.crop.x 850 --ocr.crop.y 0 --ocr.crop.h 200 --ocr.crop.w 400 --ocr.invert False\n</code></pre> <p>If there are no events defined in the configuration, then the image will be looked for in the current working directory.</p>"},{"location":"debug_tools/#directory-listing","title":"Directory Listing","text":"<p>This will list the images in the current directory that match the ANPR image regular expression</p> <pre><code>uv run tools list_dir\n</code></pre> <p>Like the OCR example, this also allows any of the <code>event</code> config to be changed, in this example trying out a regular expression to match the file</p> <pre><code>uv run tools list_dir --event.watch_path /ftp/Driveway --event.image_name_re '(?P&lt;dt&gt;[0-9]{17})_(?P&lt;target&gt;[A-Z0-9]+)_(?P&lt;event&gt;VEHICLE_DETECTION)\\.(?P&lt;ext&gt;jpg|png|gif|jpeg)'\n</code></pre>"},{"location":"homeassistant/","title":"HomeAssistant Integration","text":"<p><code>anpr2mqtt</code> represents each ANPR cameras as a MQTT Sensor and MQTT Image entities, and uses MQTT discovery so that HomeAssistant automatically picks up components discovered by ANPR2MQTT with zero configuration on HomeAssistant itself. </p> <p>The MQTT image entity can be used in the same way as a <code>camera</code> entity, so can be included in mobile push, email etc notifications, or added to a Home Assistant dashboard. See the example below, or use Supernotify camera support.</p>"},{"location":"homeassistant/#attributes","title":"Attributes","text":"<p>Both the <code>sensor</code> and <code>image</code> attributes have the same extensive set of attributes.</p> <p>The target value will also appear in a field named after <code>target_type</code>, for example, <code>plate</code> for easier to read Home Assistant automations.</p> Attribute Example target J23TST target_type plate <code>target_type</code> J23TST vehicle_direction Forward reg_info null area driveway camera drivewacam file_path /ftp/Driveway/20260108141528320_J23TST_VEHICLE_DETECTION.jpg event_image_url http://192.168.10.10/cctv//ftp/Driveway/20260108141528320_J23TST_VEHICLE_DETECTION.jpg orig_plate J23TST ignore false known true dangerous false priority medium description Amazon Prime previous_sightings 15 last_sighting 2026-01-08T14:15:28.000319+00:00 event_time 2026-01-08T14:15:28.000320+00:00 image_event VEHICLE DETECTION ext jpg image_size 124907 <p>The <code>reg_info</code> will be populated with the licence plate API lookup, for example UK DVLA, if provided.</p>"},{"location":"homeassistant/#example-automation","title":"Example Automation","text":"<p>This example uses Supernotify to generate multiple alerts, such as email with ANPR image attachment, mobile push with the image and click through to Frigate page, voice assistant announcement and sounding chimes. It can also be used with any of the built-in notification integrations, though without the same multiple-transport and media handling capabilities.</p> <pre><code>alias: Driveway ANPR Alert\ndescription: \"Notify via email, chime, Alexa and mobile push when a vehicle identified\"\ntriggers:\n  - trigger: state\n    entity_id:\n      - sensor.anpr_driveway\nconditions:\n  - condition: not\n    conditions:\n      - condition: state\n        entity_id: sensor.anpr_driveway\n        state:\n          - unavailable\n          - unknown\nactions:\n  - action: notify.supernotify\n    metadata: {}\n    data:\n      message: &gt;-\n        {{ trigger.to_state.attributes.description }} with {{\n        trigger.to_state.attributes.plate }} spotted at {{\n        trigger.to_state.attributes.camera }} camera, moving {{\n        trigger.to_state.attributes.vehicle_direction }}\n\n        {% if trigger.to_state.attributes.previous_sightings == 0 %} Not\n        previously sighted  {% else %}  with {{\n        trigger.to_state.attributes.previous_sightings }} previous sightings. {%\n        endif %} {% if trigger.to_state.attributes.last_sighting is defined %}\n        last seen on {{ trigger.to_state.attributes.last_sighting[:10] }} at {{\n        trigger.to_state.attributes.last_sighting[11:16] }}   {% endif %}\n\n        {% if trigger.to_state.attributes.reginfo is defined %}  DVLA info: {{\n        trigger.to_state.attributes.reginfo }}   {% endif %}\n      title: &gt;-\n        {{ trigger.to_state.attributes.description }} spotted on {{\n        trigger.to_state.attributes.camera }} camera\n      data:\n        priority: \"{{ trigger.to_state.attributes.priority }}\"\n        apply_scenarios: &gt;-\n          {% if trigger.to_state.attributes.known %}known_vehicle{% else\n          %}unknown_vehicle{% endif %}\n        constrain_scenarios:\n          - known_vehicle\n          - unknown_vehicle\n        media:\n          camera_entity_id: image.anpr_{{trigger.to_state.attributes.camera}}\n          snapshot_url: \"{{ trigger.to_state.attributes.event_image_url }}\"\nmode: single\n</code></pre>"},{"location":"homeassistant/#configuration","title":"Configuration","text":"<p>In general, no configuration is needed, if Home Assistant is already running with MQTT, and the defaults haven't been changed.</p> <p>Make sure <code>anpr2mqtt</code> is publishing to the same broker, the MQTT Integration is installed and automatic discovery is not disabled.</p> <p></p> <p>The <code>homeassistant</code> default topic prefix matches the default ANPR2MQTT config, if its changed in HomeAssistant, then the ANPR2MQTT config must be changed to match.</p>"},{"location":"homeassistant/#device-creation","title":"Device Creation","text":"<p>A Home Assistant device will be created for each ANPR2MQTT camera, and Home Assistant will then group the relevant entities together on this device page. Use <code>device_creation: false</code> in the  <code>homeassistant</code> config block if you want to switch off this behaviour.</p>"},{"location":"homeassistant/#mqtt-topics","title":"MQTT Topics","text":"<p>There are 3 separate types of MQTT topic used for HomeAssisstant integration:</p> <ul> <li>Config to support auto discovery. <ul> <li>A topic is created per camera, with a name like <code>homeassistant/sensor/camera/anpr/config</code>. </li> <li>The <code>homeassistant</code> topic prefix can also be configured.</li> </ul> </li> <li>State to report the last plate seen and attributes<ul> <li><code>anpr2mqtt/camera_name/state</code></li> <li><code>anpr2mqtt/camera_name/image</code></li> </ul> </li> </ul>"},{"location":"homeassistant/#verifying-it-works","title":"Verifying it Works","text":"<p>Rather than wait for a container to need an update, you can check right away that Home Assistant has recognized the ANPR entities.</p> <p>From the Entities View, or the Developer Tools, filter the entities by <code>anpr.</code> </p> <p></p>"},{"location":"homeassistant/#more-home-assistant-information","title":"More Home Assistant information","text":"<ul> <li>MQTT Integration<ul> <li>Includes setting up a MQTT broker, MQTT Discovery, and trouble-shooting</li> </ul> </li> <li>MQTT Sensor</li> <li>MQTT Image</li> </ul>"},{"location":"ocr/","title":"OCR","text":"<p>Any number of textual fields can be scanned from the image. By default this happens for <code>vehicle_direction</code> as in this Hikvision example.</p> <p></p> <p>Each field can have optional permitted values (<code>Unknown</code> returned if none of them found) and a set of corrections to handle occasional OCR errors, where corrections are simple strings or regular expressions.</p> <p>Use the OCR Tool for quick tests of configuration with a local image</p>"},{"location":"ocr/#ocr-stages","title":"OCR Stages","text":"<ol> <li>Crop the image to a box starting at <code>x</code> and <code>y</code> position, measured from the bottom left of the image and a given height and width</li> <li>Optionally invert the image colours for better capture accuracy</li> <li>Run OCR over the cropped image</li> <li>Apply optional corrections</li> <li>Optionally restrict to a list of values, forcing case if needed</li> </ol>"},{"location":"ocr/#example-configuration","title":"Example Configuration","text":"<p>The configuration for this can be in the <code>anpr2mqtt.yaml</code> file, or in environment variables or command line arguments.</p> <p>In this example <code>hik_direction</code> is the <code>ocr_field_id</code> value that can be referenced in an event, and <code>label</code> is the name of the attribute that will appear in the Home Asssitant entity attributes.</p> <pre><code>ocr:\n  hik_direction:\n    label: vehicle_direction\n    values: Reverse, Forward\n    invert: true\n    crop: \n      x: 0\n      y: 850\n      h: 30\n      w: 650\n    correction:\n      Forward:\n      - F.*wd\n      Reverse:\n      - R.*v.*se\n      - Back.*\n</code></pre>"},{"location":"developer/setup/","title":"Development Setup","text":""},{"location":"developer/setup/#first-time","title":"First Time","text":"<pre><code># Install uv\ncurl -LsSf https://astral.sh/uv/install.sh | sh\n\n# Sync dependencies\nuv sync\n\n# Run the app\nuv run anpr2mqtt\n</code></pre>"},{"location":"developer/setup/#common-commands","title":"Common Commands","text":"<pre><code># Install/sync dependencies\nuv sync                    # Install all dependencies\nuv sync --no-dev          # Production only (no dev dependencies)\nuv sync --frozen          # Use lockfile without updating\n\n# Run commands\nuv run anpr2mqtt          # Run the application\nuv run pytest             # Run tests\nuv run python script.py   # Run any Python script\n\n# Manage dependencies\nuv add httpx.             # Add production dependency\nuv add --dev pytest       # Add dev dependency\nuv remove package-name    # Remove a dependency\nuv lock                   # Update lockfile after manual pyproject.toml edits\n\n# Python version management\nuv python install 3.13    # Install Python 3.12\nuv python list            # List installed Python versions\nuv venv                   # Create virtual environment\n</code></pre>"},{"location":"developer/setup/#pre-commit-hooks","title":"Pre-commit Hooks","text":"<p>This project uses pre-commit hooks:</p> <pre><code>uv run pre-commit install\nuv run pre-commit run --all-files\n</code></pre>"},{"location":"developer/setup/#docker-build","title":"Docker Build","text":"<pre><code># Build image\ndocker build -t anpr2mqtt .\n\n# Run container\ndocker run -d \\\n  --restart always \\\n  -v /path/to/ftp:/ftp \\\n  -e MQTT_HOST=192.100.10.20 \\\n  -e MQTT_PORT=1883 \\\n  -e MQTT_USER=user \\\n  -e MQTT_PASS=pass \\\n  anpr2mqtt\n</code></pre>"},{"location":"developer/setup/#dependencies-troubleshooting","title":"Dependencies Troubleshooting","text":""},{"location":"developer/setup/#need-to-regenerate-lockfile","title":"Need to regenerate lockfile?","text":"<pre><code>rm uv.lock\nuv lock\n</code></pre>"},{"location":"developer/setup/#lockfile-out-of-sync","title":"Lockfile out of sync?","text":"<pre><code>uv lock --upgrade  # Update all packages\nuv sync --frozen   # Use exact lockfile versions\n</code></pre>"},{"location":"examples/","title":"Example Configurations","text":"<p>Configuration files and Docker Compose files.</p> <p>{{ pagetree(siblings) }}</p>"},{"location":"examples/config_maximal/","title":"Maximal Configuration","text":"<p>More extensive example configuration, using all the features</p> <pre><code>---\nlog_level: debug\n\nevents:\n- camera: driveway\n  area: driveway\n  event: anpr\n  description: Vehicle identified at driveway camera\n  watch_path: /ftp/Driveway\n  image_name_re: (?P&lt;dt&gt;[0-9]{17})_(?P&lt;target&gt;[A-Z0-9]+)_(?P&lt;event&gt;VEHICLE_DETECTION)\\.(?P&lt;ext&gt;jpg|png|gif|jpeg)\n  image_url_base: http://192.168.10.10/CCTV\n  ocr_field_ids:\n    - hik_direction\n- camera: shed\n  area: back_garden\n  event: line_crossing\n  watch_path: /ftp/shedcam\n  description: Entry to back garden gate\n  image_name_re: (?P&lt;dt&gt;[0-9]{17})_(?P&lt;event&gt;LINE_CROSSING)\\.(?P&lt;ext&gt;jpg|png|gif|jpeg)\n  image_url_base: http://192.168.10.10/CCTV\n\nmqtt:\n  host: 192.168.1.100\n  port: 1883\n  user: anpr2mqtt\n  password: topsecret901\n  topic_root: anpr2mqtt\nhomeassistant:\n  discovery_topic_root: homeassistant\n  device_creation: true\nocr:\n  hik_direction:\n    label: vehicle_direction\n    values: Reverse, Forward\n    invert: true\n    crop: \n      x: 0\n      y: 850\n      h: 30\n      w: 650\n    correction:\n      Forward:\n      - F.*wd\n      Reverse:\n      - R.*v.*se\n      - Back.*\nimage:\n  jpeg_opts:\n    quality: 30\n    progressive: true\n    optimize: true\n  png_opts:\n    quality: 30\n    dpi: \"(60, 90)\"\n    optimize: true\ntracker:\n  data_dir: /data\ndvla:\n  cache_ttl: 86400\n  api_key: MY6676SECRET787KEY\ntargets:\n  plate:\n    known:\n      TJ912UKL: joe's mini\n      P001PAT: Postman\n      AM40PRM: Amazon Prime Delivery\n    dangerous:\n      B4DM3N: Rural watch reported vehicle\n    correction:\n      UN001TST:\n        - UN\\d+1TST\n        - UN001TSK\n    ignore:\n      - ^I\\dZ$ # mis-read of tanker logo\n</code></pre>"},{"location":"examples/config_minimal/","title":"Minimal Configuration","text":"<p>Smallest working configuration ( although the actual smallest is no file at all and using only environment variables for MQTT )</p> <pre><code>---\nevents:\n  - watch_path: /ftp/hikcam2\nmqtt:\n  user: anpr2mqtt\n  password: secret987\n  # assumes mqtt broker on localhost\n</code></pre>"},{"location":"examples/docker_compose/","title":"Docker Compose","text":"<p>Example Docker Compose configuration to run ANPR2MQTT as a container. This also requires a .env, or alternatively adding the environment variables directly into the compose file.</p> <pre><code>services:\n  anpr2mqtt:\n    container_name: anpr2mqtt\n    image: ghcr.io/rhizomatics/anpr2mqtt:release\n    volumes:\n      - ./config:/config  # Config file lives at /config/anpr2mqtt.yaml inside the container\n    restart: always\n    env_file: ./.env  # Optional environment variables file\n</code></pre>"},{"location":"examples/env/","title":"Environment File","text":"<p>Example <code>.env</code> file for Docker Compose configuration to separately store the environment variables.</p> <pre><code># Example env file for docker-compose.yaml\n# Used by both the app itself and the healthcheck script\n\n# To use these, add to config.yaml like ${oc.env:MQTT_HOST}\n\nMQTT__HOST=192.168.0.1\nMQTT__PORT=1883\nMQTT__USER=my_mqtt_user\nMQTT__PASS=my_mqtt_secret\n</code></pre>"},{"location":"examples/ha_automation/","title":"Home Assistant Automation","text":"<p>Example Home Assistant automation to send notifications when an MQTT update is received.</p> <p>This uses Supernotify to respect priorities and make multiple notifications for the same event - in the live example this includes Mobile Push alerts, email (with the snapshot ANPR image as an attachment), chimes ( hunting horn for known vehicles, doorbell chimes for unknown ) and Alexa spoken announcements.</p> <p>It can be adapted to a plain notification by removing the <code>data</code> section and changing the <code>action</code>. Modern Home Assistant UI allows pasting in yaml to create automations.</p> <pre><code>alias: Driveway ANPR Alert\ndescription: \"Notify via email, chime, Alexa and mobile push when a vehicle identified\"\ntriggers:\n  - trigger: state\n    entity_id:\n      - sensor.anpr_driveway\nconditions:\n  - condition: not\n    conditions:\n      - condition: state\n        entity_id: sensor.anpr_driveway\n        state:\n          - unavailable\n          - unknown\nactions:\n  - action: notify.supernotify\n    metadata: {}\n    data:\n      message: &gt;-\n        {{ trigger.to_state.attributes.description }} with {{\n        trigger.to_state.attributes.plate }} spotted at {{\n        trigger.to_state.attributes.camera }} camera, moving {{\n        trigger.to_state.attributes.vehicle_direction }}\n\n        {% if trigger.to_state.attributes.previous_sightings == 0 %} Not\n        previously sighted  {% else %}  with {{\n        trigger.to_state.attributes.previous_sightings }} previous sightings. {%\n        endif %} {% if trigger.to_state.attributes.last_sighting is defined %}\n        last seen on {{ trigger.to_state.attributes.last_sighting[:10] }} at {{\n        trigger.to_state.attributes.last_sighting[11:16] }}   {% endif %}\n\n        {% if trigger.to_state.attributes.reginfo is defined %}  DVLA info: {{\n        trigger.to_state.attributes.reginfo }}   {% endif %}\n      title: &gt;-\n        {{ trigger.to_state.attributes.description }} spotted on {{\n        trigger.to_state.attributes.camera }} camera\n      data:\n        priority: \"{{ trigger.to_state.attributes.priority }}\"\n        apply_scenarios: &gt;-\n          {% if trigger.to_state.attributes.known %}known_vehicle{% else\n          %}unknown_vehicle{% endif %}\n        constrain_scenarios:\n          - known_vehicle\n          - unknown_vehicle\n        media:\n          camera_entity_id: image.anpr_{{trigger.to_state.attributes.camera}}\n          snapshot_url: \"{{ trigger.to_state.attributes.event_image_url }}\"\nmode: single\n</code></pre>"},{"location":"developer/coverage/","title":"Coverage","text":""}]}